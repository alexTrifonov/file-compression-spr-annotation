# file-compression-spr-annotation

Консольное приложение для сжатия файлов формата jpeg, png.
Для конфигурации Spring Context используется Java Config.
В качестве библиотеки для сжатия файлов используется Tinify https://tinypng.com/developers/reference/java
Для работы библиотеки необходимо получить один или несколько ключей https://tinypng.com/developers.
Приложение собирается в исполняемый jar-файл.

Приложение разработано таким образом, чтобы сжать все файлы в обозначенной директории и дереве поддиректорий и
 сохранить исходную структуру директорий с этими файлами.
Для этого в отдельной директории формируется подобная исходной структура директорий и сжатые файлы перемещаются
 в эту отдельную директорию на то же место, как и в исходной директории.

Использование приложения:
1. В директории с jar файлом создать поддиректорию source-pictures, в нее поместить каталог или каталоги со сжимаемыми файлами.
2. В директории с jar файлом создать файл keys.txt, в него поместить ключи. Каждый ключ в новой строчке.
3. Запустить исполняемый jar файл командой:
java -jar file-compression-spr-annotation-version.jar

По результатам работы приложения сжатые файлы будут расположены в директории с jar файлом в поддиректории result-pictures
 (на тех же местах в структуре каталогов, как и в поддиректории source-pictures).
Если ключей оказалось недостаточно для сжатия файлов, то удалить использованные ключи из файла keys.txt и добавить новые.
Количество сжатых файлов по завершению работы приложения записывается в директорию с jar файлом в поддиректорию 
compression-report в файл count-compressed.txt с меткой времени в названии.


По умолчанию файлы сжимает один поток и каждый ключ используются  до получения 
исключения по этому ключу. После получения исключения по данному ключу приложение перестает использовать данный ключ и берет следующий.
Если необходимо задать количество потоков (от 2 до 10), то необходимо при запуске jar файла задать аргумент командной строки:
java -jar file-compression-spr-annotation-version.jar thread=10



По завершению работы формируются отчеты в директории с jar файлом в поддиректории compression-report.
Файлы с отчетами имеют в названии метки времени.
Обозначения файлов:
count-compressed.txt - имя файла с отчетом о количестве сжатых файлов в результате работы приложения. 
failed-files.txt - имя файла для отчета со списком  файлов, которые не удалось сжать, либо возникли ошибки при перемещении в папку со сжатыми файлами, 
	 либо возникли ошибки при удалении файлов из папки с исходными файлами после сжатия.
failed-keys.txt - имя файла для отчета со списком не зарегистрированных на сервере Tinify ключей (не принадлежащих аутентифицированным пользователям).
compressed-files-by-key.txt - имя файла для отчета со списком ключей и количеством сжатых файлов по каждому ключу.
failed-read-files.txt - имя файла для отчета со списком  файлов, которые не удалось прочитать.

После сжатия всех файлов в поддиректории source-pictures очистить содержимое этой поддиректории. Перед добавлением новой партии файлов для 
сжатия в поддиректорию source-pictures и запуском приложения очистить поддиректорию result-pictures
